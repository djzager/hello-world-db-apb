FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="1.0"
LABEL "com.redhat.apb.spec"=\
"bmFtZTogaGVsbG8td29ybGQtZGItYXBiCmltYWdlOiBhbnNpYmxlcGxheWJvb2tidW5kbGUvaGVs\
bG8td29ybGQtZGItYXBiCmRlc2NyaXB0aW9uOiBBIHNhbXBsZSBBUEIgd2hpY2ggZGVwbG95cyBI\
ZWxsbyBXb3JsZCBEYXRhYmFzZQpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0YWRh\
dGE6CiAgZGlzcGxheU5hbWU6IEhlbGxvIFdvcmxkIERhdGFiYXNlIChBUEIpCiAgZGVwZW5kZW5j\
aWVzOiBbJ2RvY2tlci5pby9jZW50b3MvcG9zdGdyZXNxbC05NC1jZW50b3M3J10KICBwcm92aWRl\
ckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAg\
ICBkZXNjcmlwdGlvbjogQSBzYW1wbGUgQVBCIHdoaWNoIGRlcGxveXMgSGVsbG8gV29ybGQgRGF0\
YWJhc2UKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVm\
YXVsdAogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBkZXBsb3lzIGEgUG9zdGdyZXMg\
RGF0YWJhc2UgdGhlIEhlbGxvIFdvcmxkIGFwcGxpY2F0aW9uIGNhbiBjb25uZWN0IHRvCiAgICAg\
IGNvc3Q6ICQwLjAwCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IHBvc3RncmVzcWxfYWRt\
aW5fcGFzc3dvcmQKICAgICAgICB0aXRsZTogUG9zdGdyZVNRTCBBZG1pbiBQYXNzd29yZAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICBiaW5kX3BhcmFtZXRl\
cnM6CiAgICAgIC0gbmFtZTogcG9zdGdyZXNxbF9kYl9uYW1lCiAgICAgICAgdGl0bGU6IFBvc3Rn\
cmVTUUwgRGF0YWJhc2UgTmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgZGVmYXVsdDogaGVsbG8td29ybGQKICAgICAgLSBuYW1lOiBwb3N0Z3Jl\
c3FsX3VzZXIKICAgICAgICB0aXRsZTogUG9zdGdyZVNRTCBVc2VyCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBoZWxsby13b3JsZC11\
c2VyCiAgICAgIC0gbmFtZTogcG9zdGdyZXNxbF9wYXNzd29yZAogICAgICAgIHRpdGxlOiBQb3N0\
Z3JlU1FMIFBhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRy\
dWUK"

RUN yum -y install postgresql-libs python-psycopg2 && yum clean all
COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
